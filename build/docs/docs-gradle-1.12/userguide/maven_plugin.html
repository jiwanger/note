<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>第五十二章. Maven 插件 - Chapter&nbsp;52.&nbsp;The Maven Plugin</title>
  <link xmlns:xslthl="http://xslthl.sf.net" type="text/css" rel="stylesheet" href="base.css">
  <link xmlns:xslthl="http://xslthl.sf.net" type="text/css" rel="stylesheet" href="docs.css">
  <link xmlns:xslthl="http://xslthl.sf.net" type="text/css" rel="stylesheet" href="userguide.css">
  <meta content="DocBook XSL Stylesheets V1.75.2" name="generator">
  <link rel="home" href="userguide.html" title="Gradle 用户指南">
  <link rel="up" href="userguide.html" title="Gradle 用户指南">
  <link rel="prev" href="artifact_management.html" title="第五十一章. 发布构件">
  <link rel="next" href="signing_plugin.html" title="第五十三章. 签名插件">
 </head>
 <body>
  <div class="navheader">
   <div>
    <div class="navbar">
     <a xmlns:xslthl="http://xslthl.sf.net" href="artifact_management.html" title="第五十一章. 发布构件">上一章</a>
     <span>|</span>
     <a xmlns:xslthl="http://xslthl.sf.net" href="userguide.html" title="Gradle 用户指南">目录</a>
     <span>|</span>
     <a xmlns:xslthl="http://xslthl.sf.net" href="signing_plugin.html" title="第五十三章. 签名插件">下一章</a>
    </div>
   </div>
  </div>
  <div class="chapter">
   <div class="titlepage">
    <div>
     <div>
      <h1 xmlns:xslthl="http://xslthl.sf.net"><a name="maven_plugin"></a>第五十二章. Maven 插件</h1>
      <h3 xmlns:xslthl="http://xslthl.sf.net"><a name="maven_plugin"></a>Chapter&nbsp;52.&nbsp;The Maven Plugin</h3>
     </div>
    </div>
   </div>
   <div class="note">
    <p>此章节还在完善中。<br>This chapter is a work in progress</p>
   </div>
   <p>Maven 插件添加了将项目部署到 Maven 仓库的支持。<br>The Maven plugin adds support for deploying artifacts to Maven repositories.</p>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="N1542C"></a>52.1.&nbsp;用法</h2>
       <h4 class="title"><a name="N1542C"></a>52.1.&nbsp;Usage</h4>
      </div>
     </div>
    </div>
    <p>要使用 Maven 插件，请在构建脚本中包含以下语句：<br>To use the Maven plugin, include in your build script:</p>
    <div class="example">
     <a name="useMavenPlugin"></a>
     <p class="title"><b>示例 52.1. 使用 Maven 插件 - Example&nbsp;52.1.&nbsp;Using the Maven plugin</b></p>
     <div class="example-contents">
      <p><code class="filename">build.gradle</code></p>
      <pre class="programlisting">apply plugin: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'maven'</span></pre>
     </div>
    </div>
    <br class="example-break">
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="N1543B"></a>52.2. 任务</h2>
       <h4 class="title"><a name="N1543B"></a>52.2.&nbsp;Tasks</h4>
      </div>
     </div>
    </div>
    <p>Maven 插件定义了以下任务：<br>The Maven plugin defines the following tasks:</p>
    <div xmlns:xslthl="http://xslthl.sf.net" class="table">
     <p class="title"><b>表 52.1. Maven 插件 - 任务 - Table&nbsp;52.1.&nbsp;Maven plugin - tasks</b></p>
     <div class="table-contents">
      <table id="N15440">
       <thead>
        <tr> 
         <td>任务名称<br>Task name</td> 
         <td>依赖于<br>Depends on</td> 
         <td>类型<br>Type</td> 
         <td>描述<br>Description</td> 
        </tr>
       </thead>
       <tbody>
        <tr> 
         <td> <code class="literal">install</code> </td> 
         <td> 所有构建相关archives的任务。 <br>All tasks that build the associated archives.</td> 
         <td><a class="ulink" href="http://gradledoc.qiniudn.com/1.12/dsl/org.gradle.api.tasks.Upload.html" target="_top"><code class="classname">Upload</code></a></td> 
         <td>将相关的构件安装到本地的 Maven 缓存，包括 Maven 元数据的生成。默认情况下 install 任务是与<code class="literal">archives</code>配置相关联的。该项配置在默认情况下只包含默认的 jar 文件。要了解更多关于安装到本地资源库的内容，请参阅：<a class="xref" href="maven_plugin.html#sub:installing_to_the_local_repository">第 52.6.3 节，“安装到本地仓库”</a><br>Installs the associated artifacts to the local Maven cache, including Maven metadata generation. By default the install task is associated with the <code class="literal">archives</code> configuration. This configuration has by default only the default jar as an element. To learn more about installing to the local repository, see: <a class="xref" href="maven_plugin.html#sub:installing_to_the_local_repository">Section&nbsp;52.6.3, “Installing to the local repository”</a></td> 
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="N1546B"></a>52.3. 依赖管理</h2>
       <h4 class="title"><a name="N1546B"></a>52.3.&nbsp;Dependency management</h4>
      </div>
     </div>
    </div>
    <p>Maven 插件不定义任何依赖配置。<br>The Maven plugin does not define any dependency configurations.</p>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="N15470"></a>52.4. 约定属性</h2>
       <h4 class="title"><a name="N15470"></a>52.4.&nbsp;Convention properties</h4>
      </div>
     </div>
    </div>
    <p>Maven 插件定义了下列约定属性：<br>The Maven plugin defines the following convention properties:</p>
    <div xmlns:xslthl="http://xslthl.sf.net" class="table">
     <p class="title"><b>表 52.2. Maven 插件 - 属性 - Table&nbsp;52.2.&nbsp;Maven plugin - properties</b></p>
     <div class="table-contents">
      <table id="N15475">
       <thead>
        <tr> 
         <td>属性名称<br>Property name</td> 
         <td>类型<br>Type</td> 
         <td>默认值<br>Default value</td> 
         <td>描述<br>Description</td> 
        </tr>
       </thead>
       <tbody>
        <tr> 
         <td> <code class="literal">pomDirName</code> </td> 
         <td> <code class="classname">String</code> </td> 
         <td> <code class="literal">poms</code> </td> 
         <td> 相对于构建目录，用于写入生成的POM的文件夹路径。 <br>The path of the directory to write the generated POMs, relative to the build directory.</td> 
        </tr>
        <tr> 
         <td> <code class="literal">pomDir</code> </td> 
         <td> <code class="classname">File (read-only)</code> </td> 
         <td> <code class="literal"><em class="replaceable"><code>buildDir</code></em>/<em class="replaceable"><code>pomDirName</code></em></code> </td> 
         <td> 生成的POM所写入的目录。 <br>The directory where the generated POMs are written to.</td> 
        </tr>
        <tr> 
         <td> <code class="literal">conf2ScopeMappings</code> </td> 
         <td> <code class="classname"><a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/Conf2ScopeMappingContainer.html" target="_top"><code class="classname">Conf2ScopeMappingContainer</code></a></code> </td> 
         <td> <code class="literal">n/a</code> </td> 
         <td> 将Gradle配置映射到Maven scopes的说明。见<a class="xref" href="maven_plugin.html#sub:dependency_mapping"> 52.6.4.2 节，“依赖映射”</a>。 <br>Instructions for mapping Gradle configurations to Maven scopes. See <a class="xref" href="maven_plugin.html#sub:dependency_mapping">Section&nbsp;52.6.4.2, “Dependency mapping”</a>.</td> 
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <p>这些属性由一个<a class="ulink" href="http://gradledoc.qiniudn.com/1.12/dsl/org.gradle.api.plugins.MavenPluginConvention.html" target="_top"><code class="classname">MavenPluginConvention</code></a> 的约定对象提供。<br>These properties are provided by a <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/dsl/org.gradle.api.plugins.MavenPluginConvention.html" target="_top"><code class="classname">MavenPluginConvention</code></a> convention object.</p>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="N154DD"></a>52.5.&nbsp;约定方法</h2>
       <h4 class="title"><a name="N154DD"></a>52.5.&nbsp;Convention methods</h4>
      </div>
     </div>
    </div>
    <p>Maven 插件提供了用于创建 POM 的工厂方法，如果你需要一个 POM 文件但是没有上传到 Maven 仓库的场景，这个工厂方法将非常有用。<br>The maven plugin provides a factory method for creating a POM. This is useful if you need a POM without the context of uploading to a Maven repo.</p>
    <div class="example">
     <a name="newPom"></a>
     <p class="title"><b>示例 52.2. 创建一个单独的 pom。 - Example&nbsp;52.2.&nbsp;Creating a stand alone pom.</b></p>
     <div class="example-contents">
      <p><code class="filename">build.gradle</code></p>
      <pre class="programlisting">task writeNewPom &lt;&lt; {
    pom {
        project
            inceptionYear <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'2008'</span>
            licenses {
                license {
                    name <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'The Apache Software License, Version 2.0'</span>
                    url <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'http://www.apache.org/licenses/LICENSE-2.0.txt'</span>
                    distribution <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'repo'</span>
                }
            }
        }
    }.writeTo(<span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"$buildDir/newpom.xml"</span>)
}</pre>
     </div>
    </div>
    <br class="example-break">
    <p>除其他事项外，Gradle支持和polyglot Maven同样的生成器语法。如果要了解关于 Gradle Maven POM 对象的更多信息，请参阅<a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/MavenPom.html" target="_top"><code class="classname">MavenPom</code></a>。请参见： <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/dsl/org.gradle.api.plugins.MavenPluginConvention.html" target="_top"> <code class="classname">MavenPluginConvention</code> </a> <br>Amongst other things, Gradle supports the same builder syntax as polyglot Maven. To learn more about the Gradle Maven POM object, see <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/MavenPom.html" target="_top"><code class="classname">MavenPom</code></a>. See also: <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/dsl/org.gradle.api.plugins.MavenPluginConvention.html" target="_top"><code class="classname">MavenPluginConvention</code></a></p>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="uploading_to_maven_repositories"></a>52.6. 与 Maven 仓库的交互</h2>
       <h4 class="title"><a name="uploading_to_maven_repositories"></a>52.6.&nbsp;Interacting with Maven repositories</h4>
      </div>
     </div>
    </div>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="sec:introduction"></a>52.6.1. 介绍</h3>
        <h5 class="title"><a name="sec:introduction"></a>52.6.1.&nbsp;Introduction</h5>
       </div>
      </div>
     </div>
     <p>通过 Gradle你可以部署到远程 Maven 仓库，或者是安装到你的本地 Maven 仓库。这包括所有的 Maven 元数据操纵，并且 Maven snapshot一样可用。事实上，Gradle 的部署是 100%兼容 Maven的，因为我们在hood下使用的是本地的 Maven Ant 任务。 <br>With Gradle you can deploy to remote Maven repositories or install to your local Maven repository. This includes all Maven metadata manipulation and works also for Maven snapshots. In fact, Gradle's deployment is 100 percent Maven compatible as we use the native Maven Ant tasks under the hood.</p>
     <p>如果你没有一个POM文件，部署到 Maven 仓库只有一半的乐趣。幸运的是 Gradle 可以使用它的依赖信息为你生成这个 POM。 <br>Deploying to a Maven repository is only half the fun if you don't have a POM. Fortunately Gradle can generate this POM for you using the dependency information it has.</p>
    </div>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="sec:deploying_to_a_maven_repository"></a>52.6.2. 部署到 Maven 仓库</h3>
        <h5 class="title"><a name="sec:deploying_to_a_maven_repository"></a>52.6.2.&nbsp;Deploying to a Maven repository</h5>
       </div>
      </div>
     </div>
     <p>让我们假设你的项目只是产生默认的 jar 文件。现在你想要将这个 jar 文件部署到远程 Maven 仓库。 <br>Let's assume your project produces just the default jar file. Now you want to deploy this jar file to a remote Maven repository.</p>
     <div class="example">
      <a name="uploadFile"></a>
      <p class="title"><b>示例 52.3. 上传文件到远程 Maven 仓库 - Example&nbsp;52.3.&nbsp;Upload of file to remote Maven repository</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">apply plugin: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'maven'</span>

uploadArchives {
    repositories {
        mavenDeployer {
            repository(url: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"file://localhost/tmp/myRepo/"</span>)
        }
    }
}</pre>
      </div>
     </div>
     <br class="example-break">
     <p>就这些了。调用<code class="literal">uploadArchives</code>任务将生成 POM，并将部署构件和 POM 到指定的仓库。 <br>That is all. Calling the <code class="literal">uploadArchives</code> task will generate the POM and deploys the artifact and the POM to the specified repository.</p>
     <p>如果你需要支持<code class="literal">文件</code>之外的其他协议，那么你还需要再做一些事情。在这种情况下，我们必须将委派本地的Maven代码给第三方库实现。具体是哪些库，将取决于你需要的协议。<a class="xref" href="maven_plugin.html#wagonLibs" title="表 52.3. Maven 部署的协议 jars">表 52.3. “Maven 部署的协议jar”</a>列出了可用的协议以及相应的库（这些库又有具有传递依赖，而这些依赖也有其自己的传递依赖）。<sup>[<a href="maven_plugin.html#ftn.N15521" name="N15521" class="footnote">19</a>]</sup> 举个例子，要使用ssh协议，你可以： <br>There is some more work to do if you need support for other protocols than <code class="literal">file</code>. In this case the native Maven code we delegate to needs additional libraries. Which libraries depend on the protocol you need. The available protocols and the corresponding libraries are listed in <a class="xref" href="maven_plugin.html#wagonLibs" title="Table&nbsp;52.3.&nbsp;Protocol jars for Maven deployment">Table&nbsp;52.3, “Protocol jars for Maven deployment”</a> (those libraries have again transitive dependencies which have transitive dependencies). <sup>[<a href="maven_plugin.html#ftn.N15521" name="N15521" class="footnote">19</a>]</sup> For example to use the ssh protocol you can do:</p>
     <div class="example">
      <a name="uploadWithSsh"></a>
      <p class="title"><b>示例 52.4. 通过 SSH 上传文件 - Example&nbsp;52.4.&nbsp;Upload of file via SSH</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">configurations {
    deployerJars
}

repositories {
    mavenCentral()
}

dependencies {
    deployerJars <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"org.apache.maven.wagon:wagon-ssh:2.2"</span>
}

uploadArchives {
    repositories.mavenDeployer {
        configuration = configurations.deployerJars
        repository(url: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"scp://repos.mycompany.com/releases"</span>) {
            authentication(userName: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"me"</span>, password: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"myPassword"</span>)
        }
    }
}</pre>
      </div>
     </div>
     <br class="example-break">
     <p>Maven deployer有很多配置选项。这个配置通过一个 Groovy builder 来完成。这个配置树的所有元素都是 Java beans。你可以传一个map到bean元素中，来配置简单的属性。如果要添加另一个bean元素到它的parent，你可以使用一个闭包。在上例中<span class="emphasis"><em>repository</em></span>和<span class="emphasis"><em>authentication</em></span>都是这样的 bean 元素。<a class="xref" href="maven_plugin.html#deployerConfig" title="表 52.4. 配置 MavenDeployer 的元素">表 52.4，"MavenDeployer 的配置元素"</a>列出了可用的 bean 元素，以及 javadoc 中相应类的链接。在javadoc 中你可以看到可能的属性，这些属性你可以设置为特定的元素。 <br>There are many configuration options for the Maven deployer. The configuration is done via a Groovy builder. All the elements of this tree are Java beans. To configure the simple attributes you pass a map to the bean elements. To add another bean elements to its parent, you use a closure. In the example above <span class="emphasis"><em>repository</em></span> and <span class="emphasis"><em>authentication</em></span> are such bean elements. <a class="xref" href="maven_plugin.html#deployerConfig" title="Table&nbsp;52.4.&nbsp;Configuration elements of the MavenDeployer">Table&nbsp;52.4, “Configuration elements of the MavenDeployer”</a> lists the available bean elements and a link to the javadoc of the corresponding class. In the javadoc you can see the possible attributes you can set for a particular element.</p>
     <p>在 Maven 中你可以定义仓库和snapshot仓库。如果没有定义任何snapshot 仓库，release和snapshot都将部署到<code class="literal">repository</code>元素中。否则，snapshots将部署到<code class="literal">snapshotRepository</code>元素中。 <br>In Maven you can define repositories and optionally snapshot repositories. If no snapshot repository is defined, releases and snapshots are both deployed to the <code class="literal">repository</code> element. Otherwise snapshots are deployed to the <code class="literal">snapshotRepository</code> element.</p>
     <div xmlns:xslthl="http://xslthl.sf.net" class="table">
      <p class="title"><b>表 52.3. Maven 部署的协议 jars - Table&nbsp;52.3.&nbsp;Protocol jars for Maven deployment</b></p>
      <div class="table-contents">
       <table id="wagonLibs">
        <thead>
         <tr> 
          <td>协议<br>Protocol</td> 
          <td>Library</td> 
         </tr>
        </thead>
        <tbody>
         <tr> 
          <td>http</td> 
          <td>org.apache.maven.wagon:wagon-http:2.2</td> 
         </tr>
         <tr> 
          <td>ssh</td> 
          <td>org.apache.maven.wagon:wagon-ssh:2.2</td> 
         </tr>
         <tr> 
          <td>ssh-external</td> 
          <td>org.apache.maven.wagon:wagon-ssh-external:2.2</td> 
         </tr>
         <tr> 
          <td>ftp</td> 
          <td>org.apache.maven.wagon:wagon-ftp:2.2</td> 
         </tr>
         <tr> 
          <td>webdav</td> 
          <td>org.apache.maven.wagon:wagon-webdav:1.0-beta-2</td> 
         </tr>
         <tr> 
          <td>file</td> 
          <td>-</td> 
         </tr>
        </tbody>
       </table>
      </div>
     </div>
     <div xmlns:xslthl="http://xslthl.sf.net" class="table">
      <p class="title"><b>表 52.4. 配置 MavenDeployer 的元素 - Table&nbsp;52.4.&nbsp;Configuration elements of the MavenDeployer</b></p>
      <div class="table-contents">
       <table id="deployerConfig">
        <thead>
         <tr> 
          <td>元素<br>Element</td> 
          <td>Javadoc</td> 
         </tr>
        </thead>
        <tbody>
         <tr> 
          <td>root</td> 
          <td> <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/MavenDeployer.html" target="_top"><code class="classname">MavenDeployer</code></a> </td> 
         </tr>
         <tr> 
          <td>repository</td> 
          <td> <a class="ulink" href="http://maven.apache.org/ant-tasks/apidocs/org/apache/maven/artifact/ant/RemoteRepository.html" target="_top"> org.apache.maven.artifact.ant.RemoteRepository </a> </td> 
         </tr>
         <tr> 
          <td>authentication</td> 
          <td> <a class="ulink" href="http://maven.apache.org/ant-tasks/apidocs/org/apache/maven/artifact/ant/Authentication.html" target="_top"> org.apache.maven.artifact.ant.Authentication </a> </td> 
         </tr>
         <tr> 
          <td>releases</td> 
          <td> <a class="ulink" href="http://maven.apache.org/ant-tasks/apidocs/org/apache/maven/artifact/ant/RepositoryPolicy.html" target="_top"> org.apache.maven.artifact.ant.RepositoryPolicy </a> </td> 
         </tr>
         <tr> 
          <td>snapshots</td> 
          <td> <a class="ulink" href="http://maven.apache.org/ant-tasks/apidocs/org/apache/maven/artifact/ant/RepositoryPolicy.html" target="_top"> org.apache.maven.artifact.ant.RepositoryPolicy </a> </td> 
         </tr>
         <tr> 
          <td>proxy</td> 
          <td> <a class="ulink" href="http://maven.apache.org/ant-tasks/apidocs/org/apache/maven/artifact/ant/Proxy.html" target="_top"> org.apache.maven.artifact.ant.Proxy </a> </td> 
         </tr>
         <tr> 
          <td>snapshotRepository</td> 
          <td> <a class="ulink" href="http://maven.apache.org/ant-tasks/apidocs/org/apache/maven/artifact/ant/RemoteRepository.html" target="_top"> org.apache.maven.artifact.ant.RemoteRepository </a> </td> 
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="sub:installing_to_the_local_repository"></a>52.6.3. 安装到本地仓库</h3>
        <h5 class="title"><a name="sub:installing_to_the_local_repository"></a>52.6.3.&nbsp;Installing to the local repository</h5>
       </div>
      </div>
     </div>
     <p>Maven 插件将<code class="literal">install</code>任务添加到你的项目。这个任务依赖于<code class="literal">archives</code>配置的所有archives任务。它将这些archives安装到你的本地 Maven 仓库中。本地仓库的默认位置是否在 Maven <code class="literal">settings.xml</code>中被重新定义，这项任务也会考虑到。 <br>The Maven plugin adds an <code class="literal">install</code> task to your project. This task depends on all the archives task of the <code class="literal">archives</code> configuration. It installs those archives to your local Maven repository. If the default location for the local repository is redefined in a Maven <code class="literal">settings.xml</code>, this is considered by this task.</p>
    </div>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="sec:maven_pom_generation"></a>52.6.4.&nbsp;Maven POM 生成</h3>
        <h5 class="title"><a name="sec:maven_pom_generation"></a>52.6.4.&nbsp;Maven POM generation</h5>
       </div>
      </div>
     </div>
     <p>当部署一个artifact 到一个 Maven 库时，Gradle 会自动为它生成一个POM。下表展示了用于POM的<code class="literal">groupId</code>，<code class="literal">artifactId</code>，<code class="literal">version</code>和<code class="literal">packaging</code>元素的默认值。这些<code class="literal">dependency</code>元素由project 的依赖声明所创建。 <br>When deploying an artifact to a Maven repository, Gradle automatically generates a POM for it. The <code class="literal">groupId</code>, <code class="literal">artifactId</code>, <code class="literal">version</code> and <code class="literal">packaging</code> elements used for the POM default to the values shown in the table below. The <code class="literal">dependency</code> elements are created from the project's dependency declarations.</p>
     <div xmlns:xslthl="http://xslthl.sf.net" class="table">
      <p class="title"><b>表 52.5. Maven POM 生成的默认值 - Table&nbsp;52.5.&nbsp;Default Values for Maven POM generation</b></p>
      <div class="table-contents">
       <table id="N15605">
        <thead>
         <tr> 
          <td>Maven 元素<br>Maven Element</td> 
          <td>默认值<br>Default Value</td> 
         </tr>
        </thead>
        <tbody>
         <tr> 
          <td>groupId</td> 
          <td>project.group</td> 
         </tr>
         <tr> 
          <td>artifactId</td> 
          <td>uploadTask.repositories.mavenDeployer.pom.artifactId（如果有设置的话）或archiveTask.baseName.<br>uploadTask.repositories.mavenDeployer.pom.artifactId (if set) or archiveTask.baseName.</td> 
         </tr>
         <tr> 
          <td>version</td> 
          <td>project.version</td> 
         </tr>
         <tr> 
          <td>packaging</td> 
          <td>archiveTask.extension</td> 
         </tr>
        </tbody>
       </table>
      </div>
     </div>
     <p> 在这里， <code class="literal">uploadTask</code>和<code class="literal">archiveTask</code>分别指向上传和分别生成archive的任务（例如<code class="literal">uploadArchives</code>和<code class="literal">jar</code>）。<code class="literal">archiveTask.baseName</code>默认为<code class="literal">project.archivesBaseName</code>，后者默认为<code class="literal">project.name</code>。 <br>Here, <code class="literal">uploadTask</code> and <code class="literal">archiveTask</code> refer to the tasks used for uploading and generating the archive, respectively (for example <code class="literal">uploadArchives</code> and <code class="literal">jar</code>). <code class="literal">archiveTask.baseName</code> defaults to <code class="literal">project.archivesBaseName</code> which in turn defaults to <code class="literal">project.name</code>.</p>
     <div class="note">
      <p> 当你将<code class="literal">archiveTask.baseName</code>设置为非默认值时，请确保将<code class="literal">uploadTask.repositories.mavenDeployer.pom.artifactId</code>设置为相同的值。否则，在相同的构建中，这个项目可能会被其他项目所生成的POMs 中错误的 artifact ID所引用到。 <br>When you set <code class="literal">archiveTask.baseName</code> to a value other than the default, make sure to set <code class="literal">uploadTask.repositories.mavenDeployer.pom.artifactId</code> to the same value. Otherwise, the project at hand may be referenced with the wrong artifact ID from generated POMs for other projects in the same build.</p>
     </div>
     <p> 生成的 POMs 可以在<code class="literal">&lt;buildDir&gt;/poms</code>看到。它们可以通过<a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/MavenPom.html" target="_top"><code class="classname">MavenPom</code></a> API 进一步定制化。例如，你可能希望部署到 Maven 仓库中的artifact 有不同的版本，或者是不同于 Gradle 生成的artifact 的名称。如果要自定义这些你可以这样做： <br>Generated POMs can be found in <code class="literal">&lt;buildDir&gt;/poms</code>. They can be further customized via the <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/MavenPom.html" target="_top"><code class="classname">MavenPom</code></a> API. For example, you might want the artifact deployed to the Maven repository to have a different version or name than the artifact generated by Gradle. To customize these you can do:</p>
     <div class="example">
      <a name="customizePom"></a>
      <p class="title"><b>示例 52.5. pom定制 - Example&nbsp;52.5.&nbsp;Customization of pom</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">uploadArchives {
    repositories {
        mavenDeployer {
            repository(url: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"file://localhost/tmp/myRepo/"</span>)
            pom.version = <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'1.0Maven'</span>
            pom.artifactId = <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'myMavenName'</span>
        }
    }
}</pre>
      </div>
     </div>
     <br class="example-break">
     <p>如果要向 POM 添加其他的内容，可以使用<code class="literal">pom.project</code> 生成器。通过这个生成器，<a class="ulink" href="http://maven.apache.org/pom.html" target="_top">Maven POM 参考</a>中列出的任何元素都可以被添加进来。 <br>To add additional content to the POM, the <code class="literal">pom.project</code> builder can be used. With this builder, any element listed in the <a class="ulink" href="http://maven.apache.org/pom.html" target="_top">Maven POM reference</a> can be added.</p>
     <div class="example">
      <a name="pomBuilder"></a>
      <p class="title"><b>示例 52.6. pom 的生成器类型自定义 - Example&nbsp;52.6.&nbsp;Builder style customization of pom</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">uploadArchives {
    repositories {
        mavenDeployer {
            repository(url: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"file://localhost/tmp/myRepo/"</span>)
            pom.project {
                licenses {
                    license {
                        name <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'The Apache Software License, Version 2.0'</span>
                        url <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'http://www.apache.org/licenses/LICENSE-2.0.txt'</span>
                        distribution <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'repo'</span>
                    }
                }
            }
        }
    }
}</pre>
      </div>
     </div>
     <br class="example-break">
     <p>注：<code class="literal">groupId</code>，<code class="literal">artifactId</code>，<code class="literal">version</code>和<code class="literal">packaging</code>应该始终直接在<code class="literal">pom</code>对象上设置。 <br>Note: <code class="literal">groupId</code>, <code class="literal">artifactId</code>, <code class="literal">version</code>, and <code class="literal">packaging</code> should always be set directly on the <code class="literal">pom</code> object.</p>
     <div class="example">
      <a name="pomBuilder"></a>
      <p class="title"><b>示例 52.7. 修改自动生成的内容 - Example&nbsp;52.7.&nbsp;Modifying auto-generated content</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">[installer, deployer]*.pom*.whenConfigured {pom -&gt;
    pom.dependencies.find {dep -&gt; dep.groupId == <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'group3'</span> &amp;&amp; dep.artifactId == <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'runtime'</span> }.optional = true
}</pre>
      </div>
     </div>
     <br class="example-break">
     <p>如果你有超过一个的artifact 要发布，那么要做的事情就会有些不同。请参阅<a class="xref" href="maven_plugin.html#sub:multiple_artifacts_per_project">第 52.6.4.1 节，“一个项目多个构件”</a>。 <br>If you have more than one artifact to publish, things work a little bit differently. See<a class="xref" href="maven_plugin.html#sub:multiple_artifacts_per_project">Section&nbsp;52.6.4.1, “Multiple artifacts per project”</a>.</p>
     <p>要为 Maven installer（见<a class="xref" href="maven_plugin.html#sub:installing_to_the_local_repository">第 52.6.3 条，“安装到本地资源库”</a>) 自定义设置，你可以： <br>To customize the settings for the Maven installer (see<a class="xref" href="maven_plugin.html#sub:installing_to_the_local_repository">Section&nbsp;52.6.3, “Installing to the local repository”</a>), you can do:</p>
     <div class="example">
      <a name="customizeInstaller"></a>
      <p class="title"><b>示例 52.8. Maven installer 的自定义 - Example&nbsp;52.8.&nbsp;Customization of Maven installer</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">install {
    repositories.mavenInstaller {
        pom.version = <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'1.0Maven'</span>
        pom.artifactId = <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'myName'</span>
    }
}</pre>
      </div>
     </div>
     <br class="example-break">
     <div class="section">
      <div class="titlepage">
       <div>
        <div>
         <h4 class="title"><a name="sub:multiple_artifacts_per_project"></a>52.6.4.1. 一个项目多个构件</h4>
         <h6 class="title"><a name="sub:multiple_artifacts_per_project"></a>52.6.4.1.&nbsp;Multiple artifacts per project</h6>
        </div>
       </div>
      </div>
      <p>Maven 只可以处理一个项目一个构件。这也反映在 Maven POM 的结构中。我们认为在很多情况下，有意义一个项目有超多一个的构件。在这种情况下，你需要生成多个 POMs。在这种情况下，你必须显式声明你想要发布到一个 Maven 仓库的每一个构件。<a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/MavenDeployer.html" target="_top"><code class="classname">MavenDeployer</code></a>和 MavenInstaller 都为此提供了一个 API： <br>Maven can only deal with one artifact per project. This is reflected in the structure of the Maven POM. We think there are many situations where it makes sense to have more than one artifact per project. In such a case you need to generate multiple POMs. In such a case you have to explicitly declare each artifact you want to publish to a Maven repository. The <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/MavenDeployer.html" target="_top"><code class="classname">MavenDeployer</code></a> and the MavenInstaller both provide an API for this:</p>
      <div class="example">
       <a name="multiplePoms"></a>
       <p class="title"><b>示例 52.9. 多个 poms 的生成 - Example&nbsp;52.9.&nbsp;Generation of multiple poms</b></p>
       <div class="example-contents">
        <p><code class="filename">build.gradle</code></p>
        <pre class="programlisting">uploadArchives {
    repositories {
        mavenDeployer {
            repository(url: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"file://localhost/tmp/myRepo/"</span>)
            addFilter(<span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'api'</span>) {artifact, file -&gt;
                artifact.name == <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'api'</span>
            }
            addFilter(<span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'service'</span>) {artifact, file -&gt;
                artifact.name == <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'service'</span>
            }
            pom(<span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'api'</span>).version = <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'mySpecialMavenVersion'</span>
        }
    }
}</pre>
       </div>
      </div>
      <br class="example-break">
      <p>你需要为你想发布的每一个构件声明一个过滤器。这个过滤器为每一个它接受的 Gradle 构件定义了一个布尔表达式。每个过滤器都有一个你可以进行配置的POM与它关联。要了解更多关于它的信息，你可以看一下<a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/PomFilterContainer.html" target="_top"><code class="classname">PomFilterContainer</code></a>和其关联的类。 <br>You need to declare a filter for each artifact you want to publish. This filter defines a boolean expression for which Gradle artifact it accepts. Each filter has a POM associated with it which you can configure. To learn more about this have a look at <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/PomFilterContainer.html" target="_top"><code class="classname">PomFilterContainer</code></a> and its associated classes.</p>
     </div>
     <div class="section">
      <div class="titlepage">
       <div>
        <div>
         <h4 class="title"><a name="sub:dependency_mapping"></a>52.6.4.2.&nbsp;依赖映射</h4>
         <h6 class="title"><a name="sub:dependency_mapping"></a>52.6.4.2.&nbsp;Dependency mapping</h6>
        </div>
       </div>
      </div>
      <p>Maven 插件配置了由Java插件和War插件添加的Gradle configurations 与Maven scopes之间的默认映射。大多数情况下你不需要去接触它，并且你可以安全地跳过本节。映射过程像下面所示。你可以把一个configuration映射到一个并且只能是一个scope上。不同的configurations可以映射到一个或不同的scopes。一个configuration可以指定到一个特定的 configuration-to-scope 映射的优先级。你可以参考<a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/Conf2ScopeMappingContainer.html" target="_top"><code class="classname">Conf2ScopeMappingContainer</code></a>来了解更多的信息。要访问映射配置，你可以： <br>The Maven plugin configures the default mapping between the Gradle configurations added by the Java and War plugin and the Maven scopes. Most of the time you don't need to touch this and you can safely skip this section. The mapping works like the following. You can map a configuration to one and only one scope. Different configurations can be mapped to one or different scopes. One can assign also a priority to a particular configuration-to-scope mapping. Have a look at <a class="ulink" href="http://gradledoc.qiniudn.com/1.12/javadoc/org/gradle/api/artifacts/maven/Conf2ScopeMappingContainer.html" target="_top"><code class="classname">Conf2ScopeMappingContainer</code></a> to learn more. To access the mapping configuration you can say:</p>
      <div class="example">
       <a name="mappings"></a>
       <p class="title"><b>示例 52.10. 访问映射配置 - Example&nbsp;52.10.&nbsp;Accessing a mapping configuration</b></p>
       <div class="example-contents">
        <p><code class="filename">build.gradle</code></p>
        <pre class="programlisting">task mappings &lt;&lt; {
    println conf2ScopeMappings.mappings
}</pre>
       </div>
      </div>
      <br class="example-break">
      <p>如果有可能，Gradle排除的规则会被转换为Maven excludes。如果 Gradle 排除规则中group和module名字被指定的话（相比于Ivy，Maven对这两个都需要），这种转换是可能的。每一个configuration的排除规则如果可以被转换的话，也会包含在Maven POM中。 <br>Gradle exclude rules are converted to Maven excludes if possible. Such a conversion is possible if in the Gradle exclude rule the group as well as the module name is specified (as Maven needs both in contrast to Ivy). Per-configuration excludes are also included in the Maven POM, if they are convertible.</p>
     </div>
    </div>
   </div>
   <div class="footnotes">
    <br>
    <hr align="left" width="100">
    <div class="footnote">
     <p><sup>[<a href="maven_plugin.html#N15521" name="ftn.N15521" class="para">19</a>] </sup>已经计划在将来的发行版中为其提供开箱即用的支持。 <br><sup>[<a href="maven_plugin.html#N15521" name="ftn.N15521" class="para">19</a>] </sup>It is planned for a future release to provide out-of-the-box support for this</p>
    </div>
   </div>
  </div>
  <div class="navfooter">
   <div>
    <div class="navbar">
     <a xmlns:xslthl="http://xslthl.sf.net" href="artifact_management.html" title="第五十一章. 发布构件">上一章</a>
     <span>|</span>
     <a xmlns:xslthl="http://xslthl.sf.net" href="userguide.html" title="Gradle 用户指南">目录</a>
     <span>|</span>
     <a xmlns:xslthl="http://xslthl.sf.net" href="signing_plugin.html" title="第五十三章. 签名插件">下一章</a>
    </div>
   </div>
  </div>
 </body>
</html>
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="keywords" content="key1, key2" />
<meta name="description" content=””>
<meta name="author" content="nate">
<meta name="author" content="nate &lt;jiwanger@126.com&gt;">
<link href="images/favicon.ico" rel="bookmark" type="image/x-icon" />
<link href="images/favicon.ico" rel="icon" type="image/x-icon" />
<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
<title>NATE--笔记--LIBS</title>
<!-- Bootstrap -->
<link href="../support/bootstrap/theme/yeti-bootstrap.min.css"
	rel="stylesheet">
<!-- 
<link href="../support/bootstrap/css/bootstrap.css" rel="stylesheet">
-->
<link type="text/css" rel="stylesheet"
	href="../support/syntaxhighlighter/styles/shCoreDefault.css" />
<link href="../commons/css/common.css" rel="stylesheet">
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
	<!-- nav start -->
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target="#bs-example-navbar-collapse-1">
					<span class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="../index.html">
					<img src="../commons/images/icon.png">
				</a>
			</div>

			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul id="my-nav" class="nav navbar-nav">

				</ul>
			</div>
		</div>
	</nav>
	<!-- nav end -->


	<div class="container">
		<div class="row">
			<!-- left-menu start -->
			<div class="col-md-3">
				<div class="panel panel-default"
					style="position: fixed; top: 70px; width: 260px; height: 85%; overflow: auto; float: left;">
					<div class="panel-heading">
						<h3 class="panel-title">LIBS</h3>
					</div>
					<div class="list-group">
						<a href="#" class="list-group-item">简介</a>
						<a class="list-group-item active dropdown" data-toggle="collapse"
							data-parent="#accordion" href="#libs-layout" aria-expanded="true">
							界面类<span class="caret pull-right" style="margin-top: 5px;"></span>
						</a>
						<div id="libs-layout" class="panel-collapse collapse"
							role="tabpanel">
							<a href="#layout-" class="list-group-item">...</a>
							<a href="#layout-" class="list-group-item">...</a>
							<a href="#layout-" class="list-group-item">...</a>
							<a href="#layout-" class="list-group-item">...</a>
						</div>
						<a class="list-group-item active dropdown" data-toggle="collapse"
							data-parent="#accordion" href="#libs-effect" aria-expanded="true"
							style="border-top: 1px solid #DDDDDD;">
							效果类<span class="caret pull-right" style="margin-top: 5px;"></span>
						</a>
						<div id="libs-effect" class="panel-collapse collapse"
							role="tabpanel">
							<a href="#effect-" class="list-group-item">...</a>
							<a href="#effect-" class="list-group-item">...</a>
							<a href="#effect-" class="list-group-item">...</a>
						</div>
						<a class="list-group-item active dropdown" data-toggle="collapse"
							data-parent="#accordion" href="#libs-data" aria-expanded="true"
							style="border-top: 1px solid #DDDDDD;">
							数据类<span class="caret pull-right" style="margin-top: 5px;"></span>
						</a>
						<div id="libs-data" class="panel-collapse collapse"
							role="tabpanel">
							<a href="#data-OkHttp" class="list-group-item">OkHttp</a>
							<a href="#data-AsyncHttpClient" class="list-group-item">AsyncHttpClient</a>
							<a href="#data-Volley" class="list-group-item">Volley</a>
							<a href="#data-ThinkAndroid" class="list-group-item">ThinkAndroid</a>
							<a href="#data-GreenDao" class="list-group-item">GreenDao</a>
						</div>
						<a class="list-group-item active dropup" data-toggle="collapse"
							data-parent="#accordion" href="#libs-image" aria-expanded="true"
							style="border-top: 1px solid #DDDDDD;">
							图片类<span class="caret pull-right" style="margin-top: 5px;"></span>
						</a>
						<div id="libs-image" class="panel-collapse collapse in"
							role="tabpanel">
							<a href="#image-Glide" class="list-group-item">Glide</a>
							<a href="#image-UniversalImageLoader" class="list-group-item">UniversalImageLoader</a>
						</div>

						<a class="list-group-item active dropup" data-toggle="collapse"
							data-parent="#accordion" href="#libs-other" aria-expanded="true"
							style="border-top: 1px solid #DDDDDD;">
							其它类<span class="caret pull-right" style="margin-top: 5px;"></span>
						</a>
						<div id="libs-other" class="panel-collapse collapse in"
							role="tabpanel">
							<a href="#other-EventBus" class="list-group-item">EventBus</a>
							<a href="#other-" class="list-group-item"></a>
						</div>
					</div>
				</div>
			</div>
			<!-- left-menu over -->
		</div>
	</div>


	<div class="container" style="margin-top: 70px;">
		<div class="row">
			<div class="col-md-9 col-md-push-3" style="float: left;">
				<!-- item start -->
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">简介</h3>
					</div>
					<div class="panel-body">
						<p class="alert alert-success">
							<b>本文收集 Android 常用的框架和各种库的使用示例。</b>
						</p>
					</div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="data-OkHttp"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">OkHttp</h3>
					</div>
					<div class="panel-body">
						<p><b>OkHttp</b> 用于替代 HttpUrlConnection 和 Apache HttpClient, ANDROID API23 6.0 里已移除 HttpClient。</p>
					</div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="image-Glide"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">Glide</h3>
					</div>
					<div class="panel-body">
						<p>Glide 是一个 Android
							上的图片加载和缓存库，它不仅能实现平滑的图片列表滚动效果，还支持远程图片的获取、大小调整和展示，并且可以加载 Gif
							动态图，可谓功能强大。Glide 的集成离不开 v4 包，所以必须添加 support 包。</p>
						<div class="row">
							<div class="col-md-4">
								<p>
									项目源码 --
									<a href="https://github.com/bumptech/glide" target="_blank">
										Glide</a><br>
									项目 JAR --
									<a href="lib/glide-3.7.0.jar">glide-3.7.0.jar</a>
								</p>
								<p>Glide 模块分为</p>
								<ul>
									<li>RequestManager(请求管理器)</li>
									<li>Engine(数据获取引擎)</li>
									<li>Fetcher(数据获取器)</li>
									<li>MemoryCache(内存缓存)</li>
									<li>DiskLRUCache(SD 缓存)</li>
									<li>Transformation(图片处理)</li>
									<li>Encoder(本地缓存存储)</li>
									<li>Registry(图片类型及解析器)</li>
									<li>Target(目标)</li>
								</ul>
								<p>简单的讲就是 Glide 收到加载及显示资源的任务，创建 Request 并将它交给
									RequestManager，Request 启动 Engine 去数据源获取资源(通过 Fetcher )，获取到后
									Transformation 处理后交给 Target。</p>
							</div>
							<div class="col-md-8">
								<img src="images/overall-design-glide.jpg"
									class="img-responsive">
							</div>
						</div>

						<p>Glide 如同 ImageLoader 一样，也是可以配置一些属性的，Glide 可以在 GlideModel
							中统一配置其属性。</p>
						<pre class="brush: java;">
// GlideModel 可以在 AndroidManifest.xml 文件中注册，以便 Glide 能够找到你的 Module
&lt;meta-data
	android:name="xx.yy.GlideModelConfig"
	android:value="GlideModule" />

public class GlideModelConfig implements GlideModule {

	int diskSize = 1024 * 1024 * 100;
	// 取1/8最大内存作为最大缓存
	int memorySize = (int) (Runtime.getRuntime().maxMemory()) / 8;

	@Override
	public void applyOptions(Context context, GlideBuilder builder) {
		// 定义缓存大小和位置
		builder.setDiskCache(new InternalCacheDiskCacheFactory(context,
				diskSize)); // 内存中
		builder.setDiskCache(new ExternalCacheDiskCacheFactory(context,
				"cache", diskSize)); // sd卡中

		// 默认内存和图片池大小
		MemorySizeCalculator calculator = new MemorySizeCalculator(context);
		// 默认内存大小
		int defaultMemoryCacheSize = calculator.getMemoryCacheSize();
		// 默认图片池大小
		int defaultBitmapPoolSize = calculator.getBitmapPoolSize();
		// 该两句无需设置，是默认的
		builder.setMemoryCache(new LruResourceCache(defaultMemoryCacheSize));
		builder.setBitmapPool(new LruBitmapPool(defaultBitmapPoolSize));

		// 自定义内存和图片池大小
		builder.setMemoryCache(new LruResourceCache(memorySize));
		builder.setBitmapPool(new LruBitmapPool(memorySize));

		// 定义图片格式
		builder.setDecodeFormat(DecodeFormat.PREFER_ARGB_8888);
		builder.setDecodeFormat(DecodeFormat.PREFER_RGB_565); // 默认
	}

	@Override
	public void registerComponents(Context context, Glide glide) {
	}
}
</pre>
						<p>Glide 的常用方法:</p>
						<pre class="brush: java;">
// 1.加载网络图片
Glide.with(this).load(url).into(imageView);

// 2.加载本地图片
File file = new File(getExternalCacheDir() + "/image.jpg");
Glide.with(this).load(file).into(imageView);

// 3.加载应用资源
int resource = R.drawable.image;
Glide.with(this).load(resource).into(imageView);

// 4.加载二进制流
byte[] image = getImageBytes();
Glide.with(this).load(image).into(imageView);

// 5.加载Uri对象
Uri imageUri = getImageUri();
Glide.with(this).load(imageUri).into(imageView);

// 6.加载占位图
Glide.with(this).placeholder(R.drawable.loading);

// 7.加载错误图片
Glide.with(this).error(R.drawable.error);

// 8.禁用缓存
/**
 * DiskCacheStrategy.ALL：两个都缓存
 * DiskCacheStrategy.NONE：不缓存 
 * DiskCacheStrategy.SOURCE：缓存原始图片 
 * DiskCacheStrategy.RESULT：缓存压缩过的结果图片
 */
Glide.with(this).diskCacheStrategy(DiskCacheStrategy.NONE);

// 9.只允许加载静态图片, Glide 支持直接加载 Gif, asBitmap() 方法不需要Glide去帮我们自动进行图片格式的判断
Glide.with(this).asBitmap();

// 10.指定图片大小
Glide.with(this).override(100, 100);

// 11.显示动画, 这个动画只在初次加载出来时使用，已经加载过了，下载再从缓存中取是不会动画的。
Glide.with(this).animate(Animator animator);// 或者int animationId 
Glide.with(this).dontAnimate();// 去除动画

// 12.图片拉伸
// 长的一边撑满
Glide.with(this).centerCrop();
// 短的一边撑满
Glide.with(this).fitCenter();

// 13.转换器 -- 提供各式各样的Api可以将图片转为各种形状，例如圆形，圆角型等等
/**
 * glide-transformations -- 一个基于Glide的transformation库，拥有裁剪，着色，模糊，滤镜等多种转换效果
 * url -- https://github.com/wasabeef/glide-transformations
 */
// 单独转换器效果（毛玻璃为例）
Glide.with(this).load(R.mipmap.login)
	.bitmapTransform(new BlurTransformation(this, 20))
	.into(imageView);
// 复合转换器效果(毛玻璃加图角)
Glide.with(this).load(R.mipmap.login)
	.bitmapTransform(new BlurTransformation(this, 20), 
		new CropCircleTransformation(this))
	.into(imageView);

// 14.缓存的动态清理
Glide.get(this).clearDiskCache();		// 清理磁盘缓存 需要在子线程中执行
Glide.get(this).clearMemory();			// 清理内存缓存  可以在UI主线程中进行

// 15.暂停／恢复加载, GirdView, ListView 加载图片, 而当我们快速滑动 GridView，ListView，我们希望能停止图片的加载
Glide.with(this).pauseRequests();		// 停止图片的加载
Glide.with(this).resumeRequests();		// 恢复加载
</pre>
					</div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="libs-"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">...</h3>
					</div>
					<div class="panel-body"></div>
				</div>
				<!-- item over -->

				<!-- item start -->
				<a class="offset" id="other-EventBus"></a>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">EventBus</h3>
					</div>
					<div class="panel-body">
						<div class="sub-item">
							<p>
								官网地址 --
								<a href="http://greenrobot.org/eventbus/" target="_blank">EventBus</a>
								&nbsp;&nbsp;GitHub 地址 --
								<a href="https://github.com/greenrobot/EventBus" target="_blank">EventBus</a>
								&nbsp;&nbsp;JAR 包 --
								<a href="lib/eventbus-3.0.0.jar">EventBus-3.0.0.jar</a>
							</p>
							<p>EventBus 是一款针对 Android 优化的发布/订阅事件总线。主要功能是替代 Intent,
								Handler, BroadCast 在 Fragment，
								Activity，Service，线程之间传递消息。优点是开销小，代码更优雅。以及将发送者和接收者解耦。</p>
							<p>EventBus
								是一个消息总线，以观察者模式实现，用于简化程序的组件、线程通信，可以轻易切换线程、开辟线程。EventBus3.0
								跟先前版本的区别在于加入了 annotation @Subscribe，取代了以前约定命名的方式。</p>
							<p width="100%">
								<img style="height: 180px;"
									src="images/EventBus-Publish-Subscribe.png"
									class="img-responsive center-block">
							</p>
						</div>

						<div class="sub-item">
							<h5 class="text-primary">EventBus 使用三部曲</h5>
							<ol type="I">
								<li>
									定义事件
									<pre class="brush: java;">
public class MessageEvent {
	public final String message;

    public MessageEvent(String message) {
        this.message = message;
    }
}
</pre>
								</li>
								<li>
									准备订阅者
									<pre class="brush: java;">
//** EventBus 使用 @Subscribe 注解来标识接收消息的方法, 注意 EventBus 根据参数来确定消息接收的方法 */
@Subscribe
public void onMessageEvent(MessageEvent event){
	Toast.makeText(getActivity(), event.message, Toast.LENGTH_SHORT).show();
}

@Subscribe
public void handleSomethingElse(SomeOtherEvent event){
    doSomethingWith(event);
}

//** 在适当的生命周期中注册和反注册EventBus */
@Override
public void onStart() {
    super.onStart();
    EventBus.getDefault().register(this);
}

@Override
public void onStop() {
   EventBus.getDefault().unregister(this);
    super.onStop();
}
</pre>
								</li>
								<li>
									发送事件
									<pre class="brush: java;">
//** 消息发送根据接收方法参数类型来确定接收方法 */
EventBus.getDefault().post(new MessageEvent("Hello everyone!"));

//** 此方法就调用上面的　handleSomethingElse 方法 */
EventBus.getDefault().post(new SomeOtherEvent("Hello everyone!"));
</pre>
								</li>
							</ol>
						</div>


						<div class="sub-item">
							<h5 class="text-primary">ThreadMode</h5>
							<p>EventBus 可以很简单的实现线程间的切换，包括后台线程、UI线程、异步线程。</p>
							<ul>
								<li>
									<b>ThreadMode.POSTING</b> -- 默认调用方式，在调用 post
									方法的线程执行，避免了线程切换，性能开销最少
									<pre class="brush: java;">
@Subscribe(threadMode = ThreadMode.POSTING)
public void onMessage(MessageEvent event) {
    log(event.message);
}
</pre>
								</li>
								<li>
									<b>ThreadMode.MAIN</b> -- 在 Anroid UI 线程中执行, 这种模式可以用来替代主线程中的
									Handler 更新 UI 等操作
									<pre class="brush: java;">
@Subscribe(threadMode = ThreadMode.MAIN)
public void onMessage(MessageEvent event) {
    textField.setText(event.message);
}
</pre>
								</li>
								<li>
									<b>ThreadMode.BACKGROUND</b> -- 如果调用 post 方法的线程不是主线程，则直接在该线程执行;
									如果是主线程，则切换到后台单例线程，多个方法公用同个后台线程，按顺序执行，避免耗时操作
									<pre class="brush: java;">
@Subscribe(threadMode = ThreadMode.BACKGROUND)
public void onMessage(MessageEvent event){
    saveToDisk(event.message);
}
</pre>
								</li>
								<li>
									<b>ThreadMode.ASYNC</b> -- 开辟新独立线程，用来执行耗时操作，例如网络访问。EventBus
									内部使用了线程池，但是要尽量避免大量长时间运行的异步线程，限制并发线程数量, 可以通过 EventBusBuilder
									修改，默认使用 Executors.newCachedThreadPool()
									<pre class="brush: java;">
@Subscribe(threadMode = ThreadMode.ASYNC)
public void onMessage(MessageEvent event){
    backend.send(event.message);
}
</pre>
								</li>
							</ul>
							<p>
								<b>实例验证 ThreadMode 的 ４ 种模式</b>
							</p>
							<pre class="brush: java;">
// 默认为 @Subscribe(threadMode = ThreadMode.POSTING) 
@Subscribe
public void onEventPosting(FirstEvent event) {
	System.out.println("onEventPosting==" + Thread.currentThread().getId()
			+ "==" + event.getMsg());
}

// 此方法验证高优先级订阅者先收到消息
@Subscribe(priority = 1)
public void onEventPostingHighPriority(FirstEvent event) {
	System.out.println("onEventPostingHighPriority=="
			+ Thread.currentThread().getId() + "==" + event.getMsg());
}

// 此方法总是在 UI 线程中运行
@Subscribe(threadMode = ThreadMode.MAIN)
public void onEventMain(FirstEvent event) {
	System.out.println("onEventMain==" + Thread.currentThread().getId()
			+ "==" + event.getMsg());
}

// 此方法总是在非 UI 线程中运行
@Subscribe(threadMode = ThreadMode.BACKGROUND)
public void onEventBackGround(FirstEvent event) {
	System.out.println("onEventBackGround=="
			+ Thread.currentThread().getId() + "==" + event.getMsg());
}

// 此方法总是在新线程中运行
@Subscribe(threadMode = ThreadMode.ASYNC)
public void onEventAsync(FirstEvent event) {
	System.out.println("onEventAsync==" + Thread.currentThread().getId()
			+ "==" + event.getMsg());
}

public void execute() {
	// 1.在主线程中发送一条消息
	EventBus.getDefault().post(new FirstEvent("主线程中发送的消息!"));
	/** 输出:
	 * onEventPostingHighPriority==1==主出线程中发送的消息!
	 * onEventPosting==1==主线程中发送的消息!
	 * onEventAsync==4565==主线程中发送的消息!
	 * onEventMain==1==主线程中发送的消息!
	 * onEventBackGround==4566==主线程中发送的消息!
	 */
	
	// 2.在子线程中发送一条消息
	new Thread(new Runnable() {
		@Override
		public void run() {
			EventBus.getDefault().post(new FirstEvent("子线程中发送的消息!"));
		}
	}).start();
	/** 输出:
	 * onEventPostingHighPriority==4813==子线程中发送的消息!
	 * onEventAsync==4811==子线程中发送的消息!
	 * onEventBackGround==4813==子线程中发送的消息!
	 * onEventPosting==4813==子线程中发送的消息!
	 * onEventMain==1==子线程中发送的消息!
	 */
}
</pre>
						</div>

						<div class="sub-item">
							<h5 class="text-primary">配置 EventBusBuilder</h5>
							<p>EventBus 提供了很多配置，一般的情况下我们可以不用配置。但是，如果你有一些其他要求,
								比如控制日志在开发的时候输出, 发布的时候不输出，在开发的时候错误崩溃，而发布的时候不崩溃...等情况。</p>
							<pre class="brush: java;">
//** EventBus 提供了一个默认的实现，但不是单例。*/
EventBus eventBus = new EventBus();
// 下面这一条的效果是完全一样的
EventBus eventBus = EventBus.builder().build();
// 修改默认实现的配置，记住，必须在第一次 EventBus.getDefault() 之前配置，且只能设置一次。建议在 application 中调用
EventBus.builder().throwSubscriberException(BuildConfig.DEBUG).installDefaultEventBus();
</pre>
						</div>

						<div class="sub-item">
							<h5 class="text-primary">StickyEvent</h5>
							<p>StickyEvent
								在内存中保存最新的消息，取消原有消息，执行最新消息，只有在注册后才会执行，如果没有注册，消息会一直保留来内存中。</p>
							<pre class="brush: java;">
// 在注册之前发送消息
EventBus.getDefault().postSticky(new MessageEvent("Hello everyone!"));

@Override
public void onStart() {
    super.onStart();
    EventBus.getDefault().register(this);
}

// 在onStart调用register后，执行消息
@Subscribe(sticky = true, threadMode = ThreadMode.MAIN)
public void onEvent(MessageEvent event) {
    // UI updates must run on MainThread
    textField.setText(event.message);
}

@Override
public void onStop() {
    EventBus.getDefault().unregister(this);
    super.onStop();
}
</pre>
						</div>

						<div class="sub-item">
							<h5 class="text-primary">事件优先级和事件中止</h5>
							<p>EventBus 发送的消息，所有的订阅者都能收到。EventBus 提供了 priority
								来设置事件订阅者接收消息的顺序，级别越高的，先收到消息。</p>
							<div class="alert alert-warning">注意：优先级不会影响不同线程模式下的订阅者接收事件的顺序。</div>
							<pre class="brush: java;">
@Subscribe(priority = 1);
public void onEvent(MessageEvent event) {
	log(event.message);
}
</pre>
							<p>EventBus 在事件传递过程中，能够中止事件传递，后续事件不在调用。</p>
							<div class="alert alert-warning">事件取消仅限于
								ThreadMode.PostThread 下才可以使用。</div>
							<pre class="brush: java;">
@Subscribe
public void onEvent(MessageEvent event){
    …
    EventBus.getDefault().cancelEventDelivery(event) ;
}
</pre>
						</div>

						<div class="sub-item">
							<h5 class="text-primary">EventBus3.0 性能优化之添加索引</h5>
							<p>EventBus 使用了 annotation，默认在编译时生成代码，生成索引，添加 index
								后会在编译时运行，自动生成相应代码。</p>
							<div class="alert alert-warning">由于 apt 的限制，匿名内部类中的
								annotation 不会被识别，会自动降级在运行时反射，此时，效率会降低</div>
							<p>解决方法:</p>
							<ol>
								<li>
									为要在编译时生成索引文件，在 build.grade 文件中添加如下代码:
									<pre class="brush: groovy;">
buildscript {
    dependencies {
        classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8'
    }
}
apply plugin: 'com.neenbedankt.android-apt'
dependencies {
    compile 'org.greenrobot:eventbus:3.0.0'
    apt 'org.greenrobot:eventbus-annotation-processor:3.0.1'
}
apt {
    arguments {
    	// 这个名字可以随便写，意思是要在编译时生成使用这个类名的索引文件，所以不能与已有的类冲突
        eventBusIndex "xx.yy.MyEventBusIndex"
    }
}
</pre>
								</li>

								<li>
									上面的步骤生成了
									<code>MyEventBusIndex.class</code>
									这个类，配置 EventBus 使用这个索引:
									<pre class="brush: java;">
EventBus.builder().addIndex(new MyEventBusIndex()).installDefaultEventBus();
</pre>
								</li>
								</ul>
						</div>
					</div>
				</div>
				<!-- item over -->
			</div>
		</div>
	</div>

	<div class="btn-group-vertical bottom-button">
		<a href="#" type="button"
			class="btn btn-default dropdown-toggle dropup" data-toggle="dropup">
			<span class="caret"></span>
		</a>
		<a href="#" type="button"
			class="btn btn-default dropdown-toggle btn-primary"
			data-toggle="dropup"> TOP </a>
	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="../support/jquery/jquery-3.1.1.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="../support/bootstrap/js/bootstrap.min.js"></script>
	<script src="../support/syntaxhighlighter/scripts/shCore.js"></script>
	<script src="../support/syntaxhighlighter/scripts/shBrushJava.js"></script>
	<script src="../support/syntaxhighlighter/scripts/shBrushGroovy.js"></script>
	<script src="res/menu.js"></script>
	<script src="../commons/js/common.js"></script>
</body>
</html>
